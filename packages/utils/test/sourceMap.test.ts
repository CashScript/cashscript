import { LocationData, generateSourceMap, sourceMapToLocationData } from "../src/index.js";

it(`test sourcemap generation and decoding`, () => {
  const locationData =
  [
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } } ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } } ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } } ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } } ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } } ],
    [ { start: { line: 4, column: 21 }, end: { line: 4, column: 22 } } ],
    [ { start: { line: 4, column: 21 }, end: { line: 4, column: 22 } } ],
    [ { start: { line: 4, column: 24 }, end: { line: 4, column: 33 } } ],
    [ { start: { line: 4, column: 24 }, end: { line: 4, column: 33 } } ],
    [ { start: { line: 4, column: 12 }, end: { line: 4, column: 34 } } ],
    [ { start: { line: 4, column: 4 }, end: { line: 4, column: 36 } } ],
    [ { start: { line: 5, column: 20 }, end: { line: 5, column: 29 } } ],
    [ { start: { line: 5, column: 20 }, end: { line: 5, column: 29 } } ],
    [ { start: { line: 5, column: 12 }, end: { line: 5, column: 30 } } ],
    [ { start: { line: 5, column: 34 }, end: { line: 5, column: 46 } } ],
    [ { start: { line: 5, column: 34 }, end: { line: 5, column: 46 } } ],
    [ { start: { line: 5, column: 12 }, end: { line: 5, column: 46 } } ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } }, 1 ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } }, 1 ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } }, 1 ],
    [ { start: { line: 3, column: 2 }, end: { line: 6, column: 3 } }, 1 ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } } ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } } ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } } ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } } ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } } ],
    [ { start: { line: 9, column: 12 }, end: { line: 9, column: 21 } } ],
    [ { start: { line: 9, column: 12 }, end: { line: 9, column: 21 } } ],
    [ { start: { line: 9, column: 25 }, end: { line: 9, column: 34 } } ],
    [ { start: { line: 9, column: 25 }, end: { line: 9, column: 34 } } ],
    [ { start: { line: 9, column: 12 }, end: { line: 9, column: 34 } } ],
    [ { start: { line: 9, column: 4 }, end: { line: 9, column: 36 } } ],
    [ { start: { line: 10, column: 12 }, end: { line: 10, column: 19 } } ],
    [ { start: { line: 10, column: 12 }, end: { line: 10, column: 19 } } ],
    [ { start: { line: 10, column: 23 }, end: { line: 10, column: 30 } } ],
    [ { start: { line: 10, column: 23 }, end: { line: 10, column: 30 } } ],
    [ { start: { line: 10, column: 12 }, end: { line: 10, column: 30 } } ],
    [ { start: { line: 10, column: 4 }, end: { line: 10, column: 32 } } ],
    [ { start: { line: 11, column: 12 }, end: { line: 11, column: 13 } } ],
    [ { start: { line: 11, column: 12 }, end: { line: 11, column: 13 } } ],
    [ { start: { line: 11, column: 17 }, end: { line: 11, column: 18 } } ],
    [ { start: { line: 11, column: 17 }, end: { line: 11, column: 18 } } ],
    [ { start: { line: 11, column: 12 }, end: { line: 11, column: 18 } } ],
    [ { start: { line: 11, column: 4 }, end: { line: 11, column: 20 } } ],
    [ { start: { line: 12, column: 12 }, end: { line: 12, column: 21 } } ],
    [ { start: { line: 12, column: 12 }, end: { line: 12, column: 21 } } ],
    [ { start: { line: 12, column: 25 }, end: { line: 12, column: 34 } } ],
    [ { start: { line: 12, column: 25 }, end: { line: 12, column: 34 } } ],
    [ { start: { line: 12, column: 12 }, end: { line: 12, column: 34 } } ],
    [ { start: { line: 12, column: 4 }, end: { line: 12, column: 36 } } ],
    [ { start: { line: 13, column: 21 }, end: { line: 13, column: 22 } } ],
    [ { start: { line: 13, column: 21 }, end: { line: 13, column: 22 } } ],
    [ { start: { line: 13, column: 24 }, end: { line: 13, column: 33 } } ],
    [ { start: { line: 13, column: 24 }, end: { line: 13, column: 33 } } ],
    [ { start: { line: 13, column: 12 }, end: { line: 13, column: 34 } } ],
    [ { start: { line: 13, column: 4 }, end: { line: 13, column: 36 } } ],
    [ { start: { line: 14, column: 20 }, end: { line: 14, column: 29 } } ],
    [ { start: { line: 14, column: 20 }, end: { line: 14, column: 29 } } ],
    [ { start: { line: 14, column: 12 }, end: { line: 14, column: 30 } } ],
    [ { start: { line: 14, column: 34 }, end: { line: 14, column: 43 } } ],
    [ { start: { line: 14, column: 34 }, end: { line: 14, column: 43 } } ],
    [ { start: { line: 14, column: 12 }, end: { line: 14, column: 43 } } ],
    [ { start: { line: 14, column: 4 }, end: { line: 14, column: 45 } } ],
    [ { start: { line: 15, column: 23 }, end: { line: 15, column: 30 } } ],
    [ { start: { line: 15, column: 23 }, end: { line: 15, column: 30 } } ],
    [ { start: { line: 15, column: 4 }, end: { line: 15, column: 32 } } ],
    [ { start: { line: 15, column: 4 }, end: { line: 15, column: 32 } } ],
    [ { start: { line: 15, column: 4 }, end: { line: 15, column: 32 } }, 1 ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } }, 1 ],
    [ { start: { line: 8, column: 2 }, end: { line: 16, column: 3 } }, 1 ]
  ] as LocationData;

  const sourceMap = generateSourceMap(locationData);
  const expected = "3:2:6:3;;;;;4:21:4:22;;:24::33;;:12::34;:4::36;5:20:5:29;;:12::30;:34::46;;:12;3:2:6:3:1;;;;8::16::0;;;;;9:12:9:21;;:25::35;:12;:4::37;10:12:10:19;;:23::30;;:12;:4::32;11:12:11:13;;:17::18;;:12;:4::20;12:12:12:21;;:25::34;;:12;:4::36;13:21:13:22;;:24::33;;:12::34;:4::36;14:20:14:29;;:12::30;:34::43;;:12;:4::45;15:23:15:30;;:4::32;;8:2:16:3:1;;";
  expect(sourceMap).toBe(expected);

  const full = sourceMapToLocationData(sourceMap);
  expect(full).toEqual(locationData);
});
